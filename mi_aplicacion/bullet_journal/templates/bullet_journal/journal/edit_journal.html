{% extends "header.html" %}

{% block title %}Editar Journal{% endblock %}

{% block contenido %}
<div class="container mt-5">
    <div class="journal-form">
        <h1>Editar Journal</h1>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="date" class="form-label">Fecha:</label>
                <input type="date" class="form-control" id="date" name="date" maxlength="50"
                    value="{{ journal.date|date:'Y-m-d' }}">
            </div>

            <div class="mb-3">
                <label for="mood" class="form-label">쮺u치l es tu estado de 치nimo hoy?</label>
                <input type="text" class="form-control" id="mood" name="mood" maxlength="50"
                    value="{{ journal.mood }}">
            </div>

            <!-- NUEVA SECCI칍N DE HORAS DE SUE칌O -->
            <div class="mb-4">
                <label class="form-label">쮺u치ntas horas dormiste?</label>
                
                <input type="hidden" id="sleep_hours" name="sleep_hours" value="{{ journal.sleep_hours }}">
                <div class="sleep-selector">
                    <div class="hours-grid">
                        {% for hour in sleep_hours_options %}
                        <div class="hour-option" data-value="{{ hour }}">
                            <div class="hour-circle">
                                <span>{{ hour }}</span>
                            </div>
                            <small>hrs</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- NUEVA SECCI칍N DE VASOS DE AGUA -->
            <div class="mb-4">
                <label class="form-label">쮺u치ntos vasos de agua tomaste?</label>
                  
                <input type="hidden" id="water_glasses" name="water_glasses" value="{{ journal.water_glasses }}">
                <div class="water-selector">
                    <div class="glasses-grid">
                        {% for glass in water_glasses_options %}
                        <div class="glass-option" data-value="{{ glass }}">
                            <div class="glass-circle">
                                <span>{{ glass }}</span>
                            </div>
                            <small>vasos</small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input form-check-input-orange" id="exercise" name="exercise"
                       {% if journal.exercise %}checked{% endif %}>
                <label class="form-check-label" for="exercise">쮿iciste ejercicio hoy?</label>
            </div>

            {% if custom_habits %}
            <div class="card mb-4 border-orange">
                <div class="card-header bg-orange-light">
                    <h5 class="mb-0">Mis H치bitos Personalizados</h5>
                </div>
                <div class="card-body">
                    {% for habit in custom_habits %}
                    <div class="mb-3">
                        
                        {% if habit.type == 'boolean' %}
                            <div class="form-check">
                                <input type="checkbox"
                                    class="form-check-input form-check-input-orange"
                                    id="habit_{{ habit.id }}"
                                    name="habit_{{ habit.id }}"
                                    {% if habit.current_value %}checked{% endif %}>
                                <label class="form-check-label" for="habit_{{ habit.id }}">
                                    <strong>{{ habit.name }}</strong>
                                    {% if habit.description %}
                                        <small class="text-muted d-block">{{ habit.description }}</small>
                                    {% endif %}
                                </label>
                            </div>

                        {% elif habit.type == 'integer' %}
                            <label for="habit_{{ habit.id }}" class="form-label">
                                <strong>{{ habit.name }}</strong>
                                {% if habit.goal_value %}
                                    <span class="badge badge-orange">
                                        Meta: {{ habit.goal_value }}{% if habit.unit %} {{ habit.unit }}{% endif %}
                                    </span>
                                {% endif %}
                            </label>

                            <input 
                                type="number"
                                class="form-control"
                                id="habit_{{ habit.id }}"
                                name="habit_{{ habit.id }}"
                                min="0"
                                value="{{ habit.current_value|default:'' }}"
                                placeholder="{{ habit.goal_value|default:0 }} {% if habit.unit %}{{ habit.unit }}{% endif %}">
                            
                            {% if habit.description %}
                                <small class="form-text text-muted">{{ habit.description }}</small>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <button type="submit" class="btn btn-primary">춰Guardar mi d칤a!</button>
        </form>

        <a href="{% url 'journal_list' %}" class="link-orange">Volver</a>
    </div>
<!-- En edit_journal.html - AGREGAR despu칠s de </div> y antes de <script>: -->

</div>

<style>
/* Estilos para el selector de horas de sue침o */
.sleep-selector, .water-selector {
    padding: 15px;
    background-color: #f8f9fa;
    border-radius: 10px;
    border: 1px solid #e9ecef;
}

.hours-grid, .glasses-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
    gap: 10px;
    max-width: 100%;
}

.hour-option, .glass-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.hour-circle, .glass-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    transition: all 0.3s ease;
    border: 2px solid #dee2e6;
    background-color: white;
    margin-bottom: 5px;
}

/* Colores para horas de sue침o */
.hour-circle {
    color: #ff6614;
    border-color: #ff6614;
}

.hour-option:hover .hour-circle {
    background-color: #ff6614;
    color: white;
    transform: scale(1.1);
}

.hour-option.selected .hour-circle {
    background-color: #ff6614;
    color: white;
    box-shadow: 0 0 0 3px rgba(207, 154, 56, 0.3);
}

/* Colores para vasos de agua */
.glass-circle {
    color: #ff6614;
    border-color: #ff6614;
}

.glass-option:hover .glass-circle {
    background-color: #ff6614;
    color: white;
    transform: scale(1.1);
}

.glass-option.selected .glass-circle {
    background-color: #ff6614;
    color: white;
    box-shadow: 0 0 0 3px rgba(207, 154, 56, 0.3);
}

.hour-option small, .glass-option small {
    color: #ff6614;
    font-size: 0.75rem;
}
</style>
<!-- En edit_journal.html - REEMPLAZAR todo el <script>: -->

<script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            
            // Selector de horas de sue침o
            const sleepHiddenInput = document.getElementById('sleep_hours');
            const hourOptions = document.querySelectorAll('.hour-option');
            
            // Marcar la opci칩n actual de sue침o
            const currentSleepValue = sleepHiddenInput.value;
            hourOptions.forEach(option => {
                if (option.dataset.value == currentSleepValue) {
                    option.classList.add('selected');
                }
                
                option.addEventListener('click', function() {
                    // Remover selecci칩n anterior
                    hourOptions.forEach(opt => opt.classList.remove('selected'));
                    // Agregar selecci칩n actual
                    this.classList.add('selected');
                    // Actualizar valor oculto
                    sleepHiddenInput.value = this.dataset.value;
                });
            });
        
            // Selector de vasos de agua
            const waterHiddenInput = document.getElementById('water_glasses');
            const glassOptions = document.querySelectorAll('.glass-option');
            
            // Marcar la opci칩n actual de agua
            const currentWaterValue = waterHiddenInput.value;
            glassOptions.forEach(option => {
                if (option.dataset.value == currentWaterValue) {
                    option.classList.add('selected');
                }
                
                option.addEventListener('click', function() {
                    // Remover selecci칩n anterior
                    glassOptions.forEach(opt => opt.classList.remove('selected'));
                    // Agregar selecci칩n actual
                    this.classList.add('selected');
                    // Actualizar valor oculto
                    waterHiddenInput.value = this.dataset.value;
                });
            });
        
            // Debug de h치bitos
            const habitCheckboxes = document.querySelectorAll('input[name^="habit_"]');
            
            console.log('游댌 DEBUG: Checkboxes de h치bitos encontrados:', habitCheckboxes.length);
            
            habitCheckboxes.forEach(checkbox => {
                console.log(`游댌 DEBUG: Checkbox ${checkbox.name} est치 marcado:`, checkbox.checked);
                
                checkbox.addEventListener('change', function() {
                    console.log(`游댌 DEBUG: ${this.name} cambi칩 a:`, this.checked);
                });
            });
            
            form.addEventListener('submit', function(e) {
                console.log('游댌 DEBUG: Formulario envi치ndose...');
                console.log('游댌 DEBUG: Horas de sue침o:', sleepHiddenInput.value);
                console.log('游댌 DEBUG: Vasos de agua:', waterHiddenInput.value);
                
                const formData = new FormData(form);
                
                console.log('游댌 DEBUG: Datos del formulario:');
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}: ${value}`);
                }
                
                habitCheckboxes.forEach(checkbox => {
                    console.log(`游댌 DEBUG: ${checkbox.name} est치 en FormData?`, formData.has(checkbox.name));
                });
            });
        });
</script>

{% endblock contenido %}
