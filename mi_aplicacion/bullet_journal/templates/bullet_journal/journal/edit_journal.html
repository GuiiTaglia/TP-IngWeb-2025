{% extends "header.html" %}

{% block title %}Editar Journal{% endblock %}

{% block contenido %}
<div class="container mt-5">
    <div class="journal-form">
        <h1>Editar Journal</h1>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="date" class="form-label">Fecha:</label>
                <input type="date" class="form-control" id="date" name="date" maxlength="50"
                    value="{{ journal.date|date:'Y-m-d' }}">
            </div>

            <div class="mb-3">
                <label for="mood" class="form-label">쮺u치l es tu estado de 치nimo hoy?</label>
                <input type="text" class="form-control" id="mood" name="mood" maxlength="50"
                    value="{{ journal.mood }}">
            </div>

            <div class="mb-3">
                <label for="sleep_hours" class="form-label">쮺u치ntas horas dormiste?</label>
                <input type="number" class="form-control" id="sleep_hours" name="sleep_hours" step="0.1"
                    value="{{ journal.sleep_hours }}">
            </div>

            <div class="mb-3">
                <label for="water_glasses" class="form-label">쮺u치ntos vasos de agua tomaste?</label>
                <input type="number" class="form-control" id="water_glasses" name="water_glasses"
                    value="{{ journal.water_glasses }}">
            </div>

            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input form-check-input-orange" id="exercise" name="exercise"
                       {% if journal.exercise %}checked{% endif %}>
                <label class="form-check-label" for="exercise">쮿iciste ejercicio hoy?</label>
            </div>

            {% if custom_habits %}
            <div class="card mb-4 border-orange">
                <div class="card-header bg-orange-light">
                    <h5 class="mb-0">Mis H치bitos Personalizados</h5>
                </div>
                <div class="card-body">
                    {% for habit in custom_habits %}
                    <div class="mb-3">
                        
                        {% if habit.type == 'boolean' %}
                            <div class="form-check">
                                <input type="checkbox"
                                    class="form-check-input form-check-input-orange"
                                    id="habit_{{ habit.id }}"
                                    name="habit_{{ habit.id }}"
                                    {% if habit.current_value %}checked{% endif %}>
                                <label class="form-check-label" for="habit_{{ habit.id }}">
                                    <strong>{{ habit.name }}</strong>
                                    {% if habit.description %}
                                        <small class="text-muted d-block">{{ habit.description }}</small>
                                    {% endif %}
                                </label>
                            </div>

                        {% elif habit.type == 'integer' %}
                            <label for="habit_{{ habit.id }}" class="form-label">
                                <strong>{{ habit.name }}</strong>
                                {% if habit.goal_value %}
                                    <span class="badge badge-orange">
                                        Meta: {{ habit.goal_value }}{% if habit.unit %} {{ habit.unit }}{% endif %}
                                    </span>
                                {% endif %}
                            </label>

                            <input 
                                type="number"
                                class="form-control"
                                id="habit_{{ habit.id }}"
                                name="habit_{{ habit.id }}"
                                min="0"
                                value="{{ habit.current_value|default:'' }}"
                                placeholder="{{ habit.goal_value|default:0 }} {% if habit.unit %}{{ habit.unit }}{% endif %}">
                            
                            {% if habit.description %}
                                <small class="form-text text-muted">{{ habit.description }}</small>
                            {% endif %}
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <button type="submit" class="btn btn-primary">춰Guardar mi d칤a!</button>
        </form>

        <a href="{% url 'journal_list' %}" class="link-orange">Volver</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    
    // ARREGLADO: Buscar din치micamente todos los checkboxes de h치bitos
    const habitCheckboxes = document.querySelectorAll('input[name^="habit_"]');
    
    console.log('游댌 DEBUG: Checkboxes de h치bitos encontrados:', habitCheckboxes.length);
    
    habitCheckboxes.forEach(checkbox => {
        console.log(`游댌 DEBUG: Checkbox ${checkbox.name} est치 marcado:`, checkbox.checked);
        
        checkbox.addEventListener('change', function() {
            console.log(`游댌 DEBUG: ${this.name} cambi칩 a:`, this.checked);
        });
    });
    
    form.addEventListener('submit', function(e) {
        console.log('游댌 DEBUG: Formulario envi치ndose...');
        const formData = new FormData(form);
        
        console.log('游댌 DEBUG: Datos del formulario:');
        for (let [key, value] of formData.entries()) {
            console.log(`  ${key}: ${value}`);
        }
        
        // Verificar h치bitos espec칤ficos
        habitCheckboxes.forEach(checkbox => {
            console.log(`游댌 DEBUG: ${checkbox.name} est치 en FormData?`, formData.has(checkbox.name));
        });
    });
});
</script>

{% endblock contenido %}
