{% extends "header.html" %}
{% load static %}

{% block title %}My Journals{% endblock %}

<head>
    {% block extra_head %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&family=Forum&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link rel="stylesheet" href="{% static 'bullet_journal/css/styles.css' %}">
    {% endblock %}

</head>

{% block contenido %}
{% if user.is_authenticated %}
{% else %}
<p>You are not logged in</p>
<a href="{% url 'login' %}">Log In</a>
{% endif %}

<body>
    <div class="journal">
            
            <form method="get" class="p-3">
                <div class="row g-3 align-items-end">
                    <div class="col-md-3">
                        <label for="date" class="form-label">Fecha:</label>
                        <input type="date" id="date" name="date" value="{{ request.GET.date }}" class="form-control">
                    </div>

                    <div class="col-md-3">
                        <label for="mood" class="form-label">Estado de ánimo:</label>
                        <select id="mood" name="mood" class="form-select">
                            <option value="">Todos</option>
                            {% for mood in moods_disponibles %}
                                <option value="{{ mood }}" {% if mood == request.GET.mood %}selected{% endif %}>{{ mood }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label for="exercise" class="form-label">Hice ejercicio:</label>
                        <select id="exercise" name="exercise" class="form-select">
                            <option value="">Todos</option>
                            <option value="true" {% if request.GET.exercise == "true" %}selected{% endif %}>Sí</option>
                            <option value="false" {% if request.GET.exercise == "false" %}selected{% endif %}>No</option>
                        </select>
                    </div>

                    <div class="col-md-3 d-flex gap-2">
                        <button type="submit" class="btn btn-primary">Filtrar</button>
                        <a href="{% url 'journal_list' %}" class="btn btn-secondary">Quitar filtros</a>
                    </div>
                </div>
            </form>

            
        <ul>
        {% for journal in journals %}
            <li>
                <button class="open-popup-btn" data-journal-pk="{{ journal.pk }}">
                    {{ journal.date }}
                </button>
                <div id="popup-container-{{ journal.pk }}" class="popup-container">
                    <div class="popup-content">
                    <span class="close-btn" data-journal-pk="{{ journal.pk }}">&times;</span>
                        <p><strong>Día:</strong> {{ journal.date }}</p>         
                        <p><strong>Estado de ánimo:</strong> {{ journal.mood }}</p>
                        <p><strong>Horas de sueño:</strong> {{ journal.sleep_hours }}</p>
                        <p><strong>Vasos de agua:</strong> {{ journal.water_glasses }}</p>
                        <p><strong>Ejercicio:</strong> {% if journal.exercise %}Sí{% else %}No{% endif %}</p>

                        {% if journal.image %}
                            <p><strong>Imagen:</strong></p>
                            <img src="{{ journal.image.url }}" alt="Imagen del journal" style="max-width: 30px;">
                        {% endif %}
                    <!--button class="go-to-detail-btn" data-journal-pk="{{ journal.pk }}" data-journal-url="{% url 'journal_detail' journal.pk %}">
                        Ver detalles
                    </button--->
                    </div>
                </div>
            </li>
            {% empty %}
                <li>No hay journals.</li>
            {% endfor %}
        </ul>

            <!---ul>
            {% for journal in journals %}
                <li>
                    <button id="open-popup">Abrir Pop-up</button>

            <div id="popup-container" class="popup-container">
            <div class="popup-content">
                <span class="close-btn">&times;</span>
                <h2>¡Hola! Soy una ventana emergente</h2>
                <p>Este es el contenido de tu pop-up.</p>
            </div>
            </div>
                    <a href="{% url 'journal_detail' journal.pk %}">
                        {{ journal.date }} - {{ journal.title }}
                    </a>
                </li>
            {% empty %}
                <li>No hay journals.</li>
            {% endfor %}
            </ul--->
            <div class="journal_create">
                <a href="{% url 'journal_create' %}">¡Registrar mi día!</a>
            </div>
            
        </div>
        
<p>
</p>


<script>
    document.addEventListener('DOMContentLoaded', () => {
    // Escucha clics en cualquier botón con la clase 'open-popup-btn'
    document.querySelectorAll('.open-popup-btn').forEach(button => {
        button.addEventListener('click', (event) => {
            const journalPk = event.target.dataset.journalPk;
            const popup = document.getElementById(`popup-container-${journalPk}`);
            if (popup) {
                popup.style.display = 'flex';
            }
        });
    });

    // Escucha clics en cualquier botón de cierre
    document.querySelectorAll('.close-btn').forEach(closeBtn => {
        closeBtn.addEventListener('click', (event) => {
            const journalPk = event.target.dataset.journalPk;
            const popup = document.getElementById(`popup-container-${journalPk}`);
            if (popup) {
                popup.style.display = 'none';
            }
        });
    });

    // Escucha clics fuera de la ventana emergente para cerrar
    window.addEventListener('click', (event) => {
        if (event.target.classList.contains('popup-container')) {
            event.target.style.display = 'none';
        }
    });

    document.querySelectorAll('.go-to-detail-btn').forEach(button => {
        button.addEventListener('click', (event) => {
            const url = event.target.dataset.journalUrl;
            if (url) {
                window.location.href = url; // Redirige al usuario a la URL
            }
        });
    });
});
</script>



</body>
{% endblock %}
